<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finan√ßas Pro | HD Mobile Ready</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #e0e7ff;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #f3f4f6;
            --card: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --radius: 16px;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; font-family: 'Inter', system-ui, sans-serif; -webkit-font-smoothing: antialiased; }
        body { background: var(--bg); color: var(--text-main); margin: 0; min-height: 100vh; overflow-x: hidden; }

        header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0,0,0,0.05); padding: 1rem; position: sticky; top: 0; z-index: 100; }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .logo { font-weight: 800; font-size: 1.3rem; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        
        .menu { background: #f3f4f6; padding: 4px; border-radius: 12px; display: flex; gap: 2px; flex-wrap: wrap; width: 100%; justify-content: center; }
        @media (min-width: 900px) { .menu { width: auto; } }

        .menu button { background: transparent; border: none; color: var(--text-sub); padding: 8px 12px; cursor: pointer; transition: 0.2s; border-radius: 8px; font-weight: 600; font-size: 0.75rem; flex: 1; min-width: 80px; }
        .menu button.active { background: white; color: var(--primary); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }

        main { max-width: 1200px; margin: 1rem auto; width: 95%; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .grid-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .card { background: var(--card); padding: 1.2rem; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid rgba(255,255,255,0.7); }
        .card h3 { margin: 0 0 8px 0; font-size: 0.7rem; text-transform: uppercase; color: var(--text-sub); font-weight: 700; }
        .card .value { font-size: 1.4rem; font-weight: 800; }
        .card.accent { border-left: 4px solid var(--primary); }
        .val-up { color: var(--success); }
        .val-down { color: var(--danger); }

        .charts-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .chart-wrapper { background: white; padding: 1rem; border-radius: var(--radius); box-shadow: var(--shadow); }
        .chart-full { grid-column: 1 / -1; }

        .form-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.8rem; background: #f8fafc; padding: 1rem; border-radius: 12px; margin-bottom: 1rem; align-items: end; border: 1px solid #e2e8f0; }
        .input-box label { font-size: 0.65rem; font-weight: 800; color: var(--text-sub); margin-bottom: 4px; display: block; text-transform: uppercase; }
        input, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 0.9rem; }
        .btn-primary { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; }

        /* TABELAS RESPONSIVAS (M√ÅGICA PARA CELULAR) */
        .table-responsive { width: 100%; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; background: transparent; }
        
        @media screen and (max-width: 600px) {
            table, thead, tbody, th, td, tr { display: block; }
            thead tr { position: absolute; top: -9999px; left: -9999px; }
            tr { background: white; border-radius: 12px; margin-bottom: 10px; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #eee; }
            td { border: none; position: relative; padding-left: 50% !important; text-align: right; min-height: 35px; border-bottom: 1px solid #f9f9f9; }
            td:last-child { border-bottom: 0; margin-top: 10px; text-align: center; padding-left: 0 !important; }
            td:before { position: absolute; left: 10px; width: 45%; padding-right: 10px; white-space: nowrap; text-align: left; font-weight: 700; color: var(--text-sub); content: attr(data-label); font-size: 0.75rem; }
        }

        @media screen and (min-width: 601px) {
            table { background: white; border-radius: 12px; overflow: hidden; }
            th { background: #f8fafc; padding: 12px; text-align: left; font-size: 0.7rem; color: var(--text-sub); border-bottom: 1px solid #e2e8f0; text-transform: uppercase; }
            td { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 0.85rem; }
        }

        .btn-delete-mobile {
            background: #fee2e2; color: #ef4444; border: none; padding: 8px 15px; border-radius: 6px; font-weight: 700; cursor: pointer; width: 100%; transition: 0.2s;
        }
        .btn-delete-mobile:hover { background: #ef4444; color: white; }

        .cat-tag { display: inline-flex; align-items: center; background: #f1f5f9; padding: 5px 10px; border-radius: 20px; margin: 3px; font-size: 0.75rem; font-weight: 700; color: #475569; }
        .cat-tag button { background: none; border: none; color: var(--danger); margin-left: 5px; cursor: pointer; font-size: 1rem; }
        .badge { padding: 3px 6px; border-radius: 5px; font-size: 0.7rem; font-weight: 700; background: var(--primary-light); color: var(--primary); }
    </style>
</head>
<body>

<header>
    <div class="nav-container">
        <div class="logo"><span>üí∞</span> Finan√ßasPro</div>
        <div class="menu">
            <button onclick="changeTab('dashboard')" id="btn-dashboard" class="active">Painel</button>
            <button onclick="changeTab('receitas')" id="btn-receitas">Receitas</button>
            <button onclick="changeTab('despesas')" id="btn-despesas">Despesas</button>
            <button onclick="changeTab('orcamento')" id="btn-orcamento">Or√ßamentos</button>
            <button onclick="changeTab('metas')" id="btn-metas">Metas</button>
            <button onclick="changeTab('cartao')" id="btn-cartao">Cart√£o</button>
        </div>
    </div>
</header>

<main>
    <div style="margin-bottom: 1rem; background: white; padding: 10px; border-radius: 12px; display: inline-block; box-shadow: var(--shadow);">
        <input type="month" id="globalFilter" onchange="updateAll()" style="border: none; font-weight: 700; color: var(--primary); font-size: 0.9rem;">
    </div>

    <!-- DASHBOARD -->
    <section id="dashboard" class="tab-content active">
        <div class="grid-stats">
            <div class="card accent"><h3>M√™s/Entradas</h3><div class="value val-up" id="stat-rec-mes">R$ 0,00</div></div>
            <div class="card accent"><h3>M√™s/Sa√≠das</h3><div class="value val-down" id="stat-des-mes">R$ 0,00</div></div>
            <div class="card accent"><h3>Saldo M√™s</h3><div class="value" id="stat-saldo-mes">R$ 0,00</div></div>
        </div>

        <h2 style="font-size: 1rem; margin: 1.5rem 0 1rem; color: var(--text-sub)">Relat√≥rio Anual (<span id="txt-ano-atual">...</span>)</h2>
        <div class="grid-stats">
            <div class="card"><h3>Entradas (Ano)</h3><div class="value" id="stat-rec-ano">R$ 0,00</div></div>
            <div class="card"><h3>Sa√≠das (Ano)</h3><div class="value" id="stat-des-ano">R$ 0,00</div></div>
            <div class="card"><h3>Balan√ßo Ano</h3><div class="value" id="stat-saldo-ano">R$ 0,00</div></div>
        </div>

        <div class="chart-wrapper chart-full">
            <h3 style="margin-bottom: 1rem;">Evolu√ß√£o Mensal HD</h3>
            <canvas id="chartEvolucao" style="width: 100%; height: 250px;"></canvas>
        </div>

        <div class="charts-container">
            <div class="chart-wrapper"><h3>Categorias</h3><canvas id="chartCategorias" style="width: 100%; height: 230px;"></canvas></div>
            <div class="chart-wrapper"><h3>Fluxo</h3><canvas id="chartGeral" style="width: 100%; height: 230px;"></canvas></div>
        </div>
    </section>

    <!-- LISTAGENS COM LABEL PARA MOBILE -->
    <section id="receitas" class="tab-content">
        <div class="card">
            <h2>Lan√ßar Receita</h2>
            <form onsubmit="addReceita(event)" class="form-group">
                <div class="input-box"><label>Data</label><input type="date" id="rec-date" required></div>
                <div class="input-box"><label>Fonte</label><input type="text" id="rec-fonte" required></div>
                <div class="input-box"><label>Valor</label><input type="number" step="0.01" id="rec-valor" required></div>
                <button type="submit" class="btn-primary">Adicionar</button>
            </form>
            <div class="table-responsive">
                <table id="table-receitas">
                    <thead><tr><th>Data</th><th>Fonte</th><th>Valor</th><th>A√ß√£o</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </section>

    <section id="despesas" class="tab-content">
        <div class="card">
            <h2>Lan√ßar Despesa</h2>
            <form onsubmit="addDespesa(event)" class="form-group">
                <div class="input-box"><label>Data</label><input type="date" id="des-date" required></div>
                <div class="input-box"><label>Descri√ß√£o</label><input type="text" id="des-desc" required></div>
                <div class="input-box"><label>Cat.</label><select id="des-cat" class="cat-select-dynamic"></select></div>
                <div class="input-box"><label>Valor</label><input type="number" step="0.01" id="des-valor" required></div>
                <button type="submit" class="btn-primary">Adicionar</button>
            </form>
            <div class="table-responsive">
                <table id="table-despesas">
                    <thead><tr><th>Data</th><th>Descri√ß√£o</th><th>Categoria</th><th>Valor</th><th>A√ß√£o</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </section>

    <section id="orcamento" class="tab-content">
        <div class="card" style="margin-bottom: 20px;">
            <h2>Gerenciar Categorias</h2>
            <div class="form-group">
                <div class="input-box" style="grid-column: span 2;"><input type="text" id="new-cat-name" placeholder="Nova Categoria"></div>
                <button onclick="addCategory()" class="btn-primary">Criar</button>
            </div>
            <div id="category-list"></div>
        </div>
        <div class="card">
            <h2>Or√ßamento vs Real</h2>
            <div class="table-responsive">
                <table>
                    <thead><tr><th>Categoria</th><th>Meta</th><th>Gasto</th><th>A√ß√£o</th></tr></thead>
                    <tbody id="body-orcamento"></tbody>
                </table>
            </div>
        </div>
    </section>

    <section id="metas" class="tab-content">
        <div class="card">
            <h2>Metas</h2>
            <form onsubmit="addMeta(event)" class="form-group">
                <div class="input-box"><label>Meta</label><input type="text" id="meta-nome" required></div>
                <div class="input-box"><label>Total</label><input type="number" id="meta-total" required></div>
                <div class="input-box"><label>In√≠cio</label><input type="number" id="meta-atual" value="0"></div>
                <button type="submit" class="btn-primary">Criar</button>
            </form>
            <div id="lista-metas"></div>
        </div>
    </section>

    <section id="cartao" class="tab-content">
        <div class="card">
            <h2>Parcelados</h2>
            <form onsubmit="addCartao(event)" class="form-group">
                <div class="input-box"><label>Data</label><input type="date" id="cc-date" required></div>
                <div class="input-box"><label>Local</label><input type="text" id="cc-desc" required></div>
                <div class="input-box"><label>Cat.</label><select id="cc-cat" class="cat-select-dynamic"></select></div>
                <div class="input-box"><label>Parc.</label><input type="number" id="cc-parc" min="1" value="1"></div>
                <div class="input-box"><label>Total</label><input type="number" step="0.01" id="cc-valor"></div>
                <button type="submit" class="btn-primary">Lan√ßar</button>
            </form>
            <div class="table-responsive"><table id="table-cartao"><thead><tr><th>Data</th><th>Item</th><th>Total</th><th>A√ß√£o</th></tr></thead><tbody></tbody></table></div>
        </div>
    </section>
</main>

<script>
    let db = {
        receitas: JSON.parse(localStorage.getItem('fpro_rec')) || [],
        despesas: JSON.parse(localStorage.getItem('fpro_des')) || [],
        orcamentos: JSON.parse(localStorage.getItem('fpro_orc')) || {},
        metas: JSON.parse(localStorage.getItem('fpro_metas')) || [],
        cartao: JSON.parse(localStorage.getItem('fpro_cc')) || [],
        categorias: JSON.parse(localStorage.getItem('fpro_cats')) || ['Alimenta√ß√£o', 'Transporte', 'Moradia', 'Educa√ß√£o', 'Lazer', 'Outros']
    };

    const cores = ['#6366f1', '#10b981', '#ef4444', '#f59e0b', '#3b82f6', '#8b5cf6', '#ec4899', '#06b6d4', '#475569'];

    window.onload = () => {
        document.getElementById('globalFilter').value = new Date().toISOString().substring(0, 7);
        updateAll();
    };

    function save() {
        localStorage.setItem('fpro_rec', JSON.stringify(db.receitas));
        localStorage.setItem('fpro_des', JSON.stringify(db.despesas));
        localStorage.setItem('fpro_orc', JSON.stringify(db.orcamentos));
        localStorage.setItem('fpro_metas', JSON.stringify(db.metas));
        localStorage.setItem('fpro_cc', JSON.stringify(db.cartao));
        localStorage.setItem('fpro_cats', JSON.stringify(db.categorias));
    }

    function changeTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.menu button').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.getElementById('btn-' + tabId).classList.add('active');
        updateAll();
    }

    function setupCanvas(canvas) {
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        const ctx = canvas.getContext('2d');
        ctx.scale(dpr, dpr);
        return { ctx, width: rect.width, height: rect.height };
    }

    function deleteItem(type, id) {
        const numericId = Number(id);
        if(type === 'cc') {
            db.cartao = db.cartao.filter(i => Number(i.id) !== numericId);
            db.despesas = db.despesas.filter(i => Number(i.ccId) !== numericId);
        } else {
            db[type] = db[type].filter(i => Number(i.id) !== numericId);
        }
        save(); updateAll();
    }

    function sanitizeDB() {
    db.despesas = db.despesas.filter(d => d.date && d.mes && !isNaN(d.valor));
    db.receitas = db.receitas.filter(r => r.date && r.mes && !isNaN(r.valor));
}

    function updateAll() {
         sanitizeDB();
        const mesRef = document.getElementById('globalFilter').value;
        const anoRef = mesRef.substring(0, 4);
        document.getElementById('txt-ano-atual').innerText = anoRef;

        document.querySelectorAll('.cat-select-dynamic').forEach(s => {
            const val = s.value;
            s.innerHTML = db.categorias.map(c => `<option value="${c}">${c}</option>`).join('');
            if(val) s.value = val;
        });

        renderDashboard(mesRef, anoRef);
        renderTableReceitas(mesRef);
        renderTableDespesas(mesRef);
        renderCategoryList();
        renderOrcamento(mesRef);
        renderMetas();
        renderTableCartao();
    }

    function renderDashboard(mes, ano) {
        const rM = db.receitas.filter(r => r.mes === mes).reduce((a,b) => a+b.valor, 0);
        const dM = db.despesas.filter(d => d.mes === mes).reduce((a,b) => a+b.valor, 0);
        document.getElementById('stat-rec-mes').innerText = `R$ ${rM.toLocaleString('pt-br')}`;
        document.getElementById('stat-des-mes').innerText = `R$ ${dM.toLocaleString('pt-br')}`;
        document.getElementById('stat-saldo-mes').innerText = `R$ ${(rM-dM).toLocaleString('pt-br')}`;

        const rA = db.receitas.filter(r => r.mes.startsWith(ano)).reduce((a,b) => a+b.valor, 0);
        const dA = db.despesas.filter(d => d.mes.startsWith(ano)).reduce((a,b) => a+b.valor, 0);
        document.getElementById('stat-rec-ano').innerText = `R$ ${rA.toLocaleString('pt-br')}`;
        document.getElementById('stat-des-ano').innerText = `R$ ${dA.toLocaleString('pt-br')}`;
        document.getElementById('stat-saldo-ano').innerText = `R$ ${(rA-dA).toLocaleString('pt-br')}`;

        drawEvolucao(ano);
        drawDonut(db.despesas.filter(d => d.mes === mes));
        drawSimpleBar(rM, dM);
    }

    function drawEvolucao(ano) {
        const { ctx, width, height } = setupCanvas(document.getElementById('chartEvolucao'));
        const meses = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
        let data = meses.map((n, i) => {
            const m = `${ano}-${String(i+1).padStart(2,'0')}`;
            return {
                r: db.receitas.filter(x => x.mes === m).reduce((a,b) => a+b.valor, 0),
                d: db.despesas.filter(x => x.mes === m).reduce((a,b) => a+b.valor, 0)
            };
        });
        const max = Math.max(...data.flatMap(d => [d.r, d.d]), 100) * 1.1;
        const groupW = (width - 40) / 12;
        data.forEach((m, i) => {
            const x = 30 + i * groupW;
            ctx.fillStyle = '#6366f1'; ctx.fillRect(x, height-30-(m.r/max*(height-50)), groupW*0.3, m.r/max*(height-50));
            ctx.fillStyle = '#f43f5e'; ctx.fillRect(x+groupW*0.35, height-30-(m.d/max*(height-50)), groupW*0.3, m.d/max*(height-50));
            ctx.fillStyle = '#94a3b8'; ctx.font = '9px sans-serif'; ctx.fillText(meses[i], x, height-10);
        });
    }

    function drawDonut(data) {
        const { ctx, width, height } = setupCanvas(document.getElementById('chartCategorias'));
        let total = data.reduce((a,b) => a+b.valor, 0);
        if(!total) return;
        let angle = -0.5 * Math.PI;
        db.categorias.forEach((c, i) => {
            const v = data.filter(d => d.cat === c).reduce((a,b) => a+b.valor, 0);
            if(v > 0) {
                const slice = (v/total)*2*Math.PI;
                ctx.beginPath(); ctx.arc(width*0.3, height*.5, 55, angle, angle+slice);
                ctx.lineWidth = 18; ctx.strokeStyle = cores[i % cores.length]; ctx.stroke();
                ctx.fillStyle = ctx.strokeStyle; ctx.fillRect(width*0.6, 20+i*18, 10, 10);
                ctx.fillStyle = '#333'; ctx.font = '10px sans-serif'; ctx.fillText(c, width*0.65, 29+i*18);
                angle += slice;
            }
        });
    }

    function drawSimpleBar(r, d) {
        const { ctx, width, height } = setupCanvas(document.getElementById('chartGeral'));
        const max = Math.max(r, d, 1);
        ctx.fillStyle = '#6366f1'; ctx.fillRect(width*0.2, height*0.8-(r/max*100), 35, r/max*100);
        ctx.fillStyle = '#f43f5e'; ctx.fillRect(width*0.5, height*0.8-(d/max*100), 35, d/max*100);
    }

    function uid() {
    return Date.now() + Math.floor(Math.random() * 100000);
}

    function addReceita(e) {
        e.preventDefault();
        db.receitas.push({ id: uid(), date: document.getElementById('rec-date').value, fonte: document.getElementById('rec-fonte').value, valor: parseFloat(document.getElementById('rec-valor').value), mes: document.getElementById('rec-date').value.substring(0, 7)});
        save(); e.target.reset(); updateAll();
    }

    function addDespesa(e) {
        e.preventDefault();
        db.despesas.push({ id: uid(), date: document.getElementById('des-date').value, desc: document.getElementById('des-desc').value, cat: document.getElementById('des-cat').value, valor: parseFloat(document.getElementById('des-valor').value), mes: document.getElementById('des-date').value.substring(0, 7)});
        save(); e.target.reset(); updateAll();
    }

    function addCartao(e) {
        e.preventDefault();
        const dStr = document.getElementById('cc-date').value;
        const total = parseFloat(document.getElementById('cc-valor').value);
        const p = parseInt(document.getElementById('cc-parc').value);
        const val = total/p; const cid = uid();
        db.cartao.push({id: cid, date: dStr, desc: document.getElementById('cc-desc').value, total: total});
        let d = new Date(dStr + 'T00:00:00');
        for(let i=0; i<p; i++){
            db.despesas.push({id: uid()+i, date: d.toISOString().substring(0,10), desc: `${document.getElementById('cc-desc').value} (${i+1}/${p})`, cat: document.getElementById('cc-cat').value, valor: val, mes: d.toISOString().substring(0,7), ccId: cid});
            d.setMonth(d.getMonth()+1);
        }
        save(); e.target.reset(); updateAll();
    }

    function renderTableReceitas(mes) {
        const list = db.receitas.filter(r => r.mes === mes);
        document.querySelector('#table-receitas tbody').innerHTML = list.map(r => `
            <tr>
                <td data-label="Data">${r.date.split('-').reverse().join('/')}</td>
                <td data-label="Fonte">${r.fonte}</td>
                <td data-label="Valor" class="val-up">R$ ${r.valor.toFixed(2)}</td>
                <td><button class="btn-delete-mobile" onclick="deleteItem('receitas', ${r.id})">Excluir</button></td>
            </tr>
        `).join('');
    }

    function renderTableDespesas(mes) {
        const list = db.despesas.filter(d => d.mes === mes);
        document.querySelector('#table-despesas tbody').innerHTML = list.map(d => `
            <tr>
                <td data-label="Data">${d.date.split('-').reverse().join('/')}</td>
                <td data-label="Item">${d.desc}</td>
                <td data-label="Categoria"><span class="badge">${d.cat}</span></td>
                <td data-label="Valor" class="val-down">R$ ${d.valor.toFixed(2)}</td>
                <td><button class="btn-delete-mobile" onclick="deleteItem('despesas', ${d.id})">Excluir</button></td>
            </tr>
        `).join('');
    }

    function addCategory() {
        const n = document.getElementById('new-cat-name').value.trim();
        if(n && !db.categorias.includes(n)){ db.categorias.push(n); save(); updateAll(); }
    }

    function deleteCategory(c) {
        if(c==='Outros') return;
        db.categorias = db.categorias.filter(x => x!==c);
        db.despesas.forEach(d => { if(d.cat === c) d.cat = 'Outros'; });
        save(); updateAll();
    }

    function renderCategoryList() {
        document.getElementById('category-list').innerHTML = db.categorias.map(c => `<span class="cat-tag">${c} ${c!=='Outros'?`<button onclick="deleteCategory('${c}')">&times;</button>`:''}</span>`).join('');
    }

    function renderOrcamento(mes) {
        const des = db.despesas.filter(d => d.mes === mes);
        document.getElementById('body-orcamento').innerHTML = db.categorias.map(cat => {
            const v = des.filter(d => d.cat === cat).reduce((a,b) => a+b.valor, 0);
            const o = db.orcamentos[cat] || 0;
            return `<tr><td data-label="Categoria"><strong>${cat}</strong></td><td data-label="Meta"><input type="number" value="${o}" onchange="db.orcamentos['${cat}']=parseFloat(this.value);save();updateAll();"></td><td data-label="Gasto">R$ ${v.toFixed(2)}</td><td><span class="badge" style="background:${(o-v)<0?'#fee2e2':'#d1fae5'}">${(o-v)<0?'Excedido':'OK'}</span></td></tr>`;
        }).join('');
    }

    function addMeta(e) {
        e.preventDefault();
        db.metas.push({id: Date.now(), nome: document.getElementById('meta-nome').value, total: parseFloat(document.getElementById('meta-total').value), atual: parseFloat(document.getElementById('meta-atual').value)});
        save(); e.target.reset(); updateAll();
    }

    function renderMetas() {
        document.getElementById('lista-metas').innerHTML = db.metas.map(m => `
            <div class="card" style="margin-top:10px">
                <strong>${m.nome}</strong> - R$ ${m.atual} / R$ ${m.total}
                <div style="background:#eee; height:8px; border-radius:4px; margin:10px 0"><div style="background:var(--success); width:${Math.min((m.atual/m.total)*100, 100)}%; height:100%; border-radius:4px"></div></div>
                <button class="btn-delete-mobile" onclick="deleteItem('metas', ${m.id})">Remover</button>
            </div>
        `).join('');
    }

    function renderTableCartao() {
        document.querySelector('#table-cartao tbody').innerHTML = db.cartao.map(c => `
            <tr><td data-label="Data">${c.date}</td><td data-label="Item">${c.desc}</td><td data-label="Total">R$ ${c.total.toFixed(2)}</td><td><button class="btn-delete-mobile" onclick="deleteItem('cc', ${c.id})">Cancelar</button></td></tr>
        `).join('');
    }
</script>
</body>
</html>

